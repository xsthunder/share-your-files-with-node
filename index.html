<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="./node_modules/angular-material/angular-material.min.css"/>
		<script src="./node_modules/angular/angular.min.js"></script>
		<script src="./node_modules/angular-material/angular-material.min.js"></script>
		<script src="./node_modules/angular-animate/angular-animate.min.js"></script>
		<script src="./node_modules/angular-aria/angular-aria.min.js"></script>
		<script src="./node_modules/angular-messages/angular-messages.min.js"></script>
	</head>
	<body>

		<div ng-app="myApp" ng-controller="siteCtrl">
			<md-content layout-padding>

				<md-list flex ng-show="show">
					<md-list-item ng-repeat="s in names" ng-click = "getfile(s)">
						{{ s }}
						<md-button ng-click="download(s)" class="md-raised md-primary">download</md-button>
					</md-list-item>
				</md-list>

				<md-button ng-click="flip()"class="md-raised md-warn">{{show?"hide":"show"}}
				</md-button>
				<md-button ng-click="pack()" class="md-raised md-primary">pack</md-button>

			</md-content>
		</div>

		<script>
var app = angular.module('myApp', ['ngMaterial']);

app.controller('siteCtrl', function($scope, $http,$mdDialog) {
	var host = window.location.host;
	var port = "";
	var log = console.log
	$http({
		method: 'GET',
		url: 'http://'+host+'/list'
	}).then(function successCallback(response) {
		console.log(response.data);
		$scope.names = response.data;
	}, function errorCallback(response) {
		// 请求失败执行代码
	});
	$scope.show = true;
	$scope.flip = function(){ $scope.show=!$scope.show; };

	$scope.getfile =function(filename){
		$http({
			method: 'POST',
			url: 'http://'+host+'/getfile',
			headers:{'Content-Type':'application/x-www-form-urlencoded'},
			data:"filename="+filename
		}).then(function successCallback(response) {
			console.log(response.data);
			function showAlert() {
				alert = $mdDialog.alert({
					title: 'Attention',
					textContent: response.data,
					ok: 'Close'
				});
				$mdDialog
					.show( alert )
					.finally(function() {
						alert = undefined;
					});
			};
			showAlert();
		}, function errorCallback(response) {
			// 请求失败执行代码
		});
	};

	$scope.pack = function(){
		window.open('http://'+host+'/pack');
	};

	$scope.download = function(s){
		window.open('http://'+host+'/files/'+s);
	};

});
		</script>

	</body>
</html>
